@using CardGames.Poker.Shared.DTOs

<div class="opponent-cards-display @GetContainerClasses()">
    @if (!string.IsNullOrEmpty(PlayerName))
    {
        <div class="player-name">@PlayerName</div>
    }
    
    <div class="opponent-cards">
        @* Face-down cards (hole cards) *@
        @foreach (var _ in Enumerable.Range(0, FaceDownCount))
        {
            <PlayingCard Card="@null"
                  IsFaceDown="@true"
                  Size="@CardSize"
                  ShowDealAnimation="@ShowDealAnimation" />
        }
        
        @* Face-up cards (stud games or showdown) *@
        @foreach (var card in FaceUpCards)
        {
            <PlayingCard Card="@card"
                  IsFaceDown="@false"
                  Size="@CardSize"
                  ShowDealAnimation="@ShowDealAnimation"
                  IsHighlighted="@IsWinningHand" />
        }
    </div>
    
    @if (HasFolded)
    {
        <div class="folded-indicator">FOLDED</div>
    }
    else if (!string.IsNullOrEmpty(HandDescription) && ShowHandDescription)
    {
        <div class="hand-description">@HandDescription</div>
    }
</div>

<style>
    .opponent-cards-display {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.25rem;
    }

    .opponent-cards-display.folded {
        opacity: 0.4;
    }

    .player-name {
        font-size: 0.7rem;
        color: rgba(255, 255, 255, 0.8);
        font-weight: bold;
        max-width: 80px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    .opponent-cards {
        display: flex;
        gap: 2px;
        justify-content: center;
    }

    .opponent-cards-display.stacked .opponent-cards > :global(.card):not(:first-child) {
        margin-left: -15px;
    }

    .opponent-cards-display.overlapped .opponent-cards > :global(.card):not(:first-child) {
        margin-left: -30px;
    }

    .folded-indicator {
        background: rgba(255, 87, 34, 0.8);
        color: white;
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 0.6rem;
        font-weight: bold;
        letter-spacing: 0.5px;
    }

    .hand-description {
        background: rgba(0, 0, 0, 0.7);
        color: #d4af37;
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 0.6rem;
        font-weight: bold;
        text-transform: uppercase;
    }

    .opponent-cards-display.winner .hand-description {
        background: linear-gradient(135deg, #d4af37 0%, #f0d060 100%);
        color: #1a1a1a;
    }
</style>

@code {
    /// <summary>
    /// The player's name.
    /// </summary>
    [Parameter]
    public string? PlayerName { get; set; }

    /// <summary>
    /// Number of face-down cards to show.
    /// </summary>
    [Parameter]
    public int FaceDownCount { get; set; } = 2;

    /// <summary>
    /// Face-up cards to display (for stud games or showdown).
    /// </summary>
    [Parameter]
    public IReadOnlyList<CardDto> FaceUpCards { get; set; } = new List<CardDto>();

    /// <summary>
    /// Whether the player has folded.
    /// </summary>
    [Parameter]
    public bool HasFolded { get; set; }

    /// <summary>
    /// Description of the hand (shown at showdown).
    /// </summary>
    [Parameter]
    public string? HandDescription { get; set; }

    /// <summary>
    /// Whether to show the hand description.
    /// </summary>
    [Parameter]
    public bool ShowHandDescription { get; set; }

    /// <summary>
    /// Whether this is a winning hand.
    /// </summary>
    [Parameter]
    public bool IsWinningHand { get; set; }

    /// <summary>
    /// Size of the cards.
    /// </summary>
    [Parameter]
    public string CardSize { get; set; } = "small";

    /// <summary>
    /// Whether to show deal animation.
    /// </summary>
    [Parameter]
    public bool ShowDealAnimation { get; set; }

    /// <summary>
    /// Layout style: "normal", "stacked", or "overlapped".
    /// </summary>
    [Parameter]
    public string Layout { get; set; } = "stacked";

    private string GetContainerClasses()
    {
        var classes = new List<string>();
        
        if (HasFolded) classes.Add("folded");
        if (IsWinningHand) classes.Add("winner");
        
        classes.Add(Layout.ToLowerInvariant() switch
        {
            "stacked" => "stacked",
            "overlapped" => "overlapped",
            _ => ""
        });
        
        return string.Join(" ", classes.Where(c => !string.IsNullOrEmpty(c)));
    }
}
