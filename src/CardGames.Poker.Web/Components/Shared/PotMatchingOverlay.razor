@namespace CardGames.Poker.Web.Components.Shared

<div class="table-overlay pot-matching-overlay">
    <div class="overlay-content">
        <div class="overlay-icon"><i class="fa-solid fa-coins"></i></div>
        <h2>Pot Matching Required</h2>
        <p class="pot-amount">Pot: @PotAmount.ToString("N0") chips</p>
        
        @if (LosingPlayers.Count > 0)
        {
            <div class="losing-players">
                <p>The following players must match the pot:</p>
                <ul>
                    @foreach (var player in LosingPlayers)
                    {
                        <li>@player</li>
                    }
                </ul>
            </div>
        }

        @if (IsLoading)
        {
            <div class="loading-spinner" style="margin: 20px auto; border-color: rgba(255,255,255,0.2); border-top-color: #fff;"></div>
            <p class="waiting-message">Loading results...</p>
        }
        else if (IsPlayerAffected)
        {
            <p class="match-warning">You must match the pot to continue playing!</p>
            <button type="button" class="btn btn-primary btn-lg" @onclick="HandleClick" disabled="@IsSubmitting">
                @if (IsSubmitting)
                {
                    <i class="fa-solid fa-spinner fa-spin"></i>
                    <span>Processing...</span>
                }
                else
                {
                    <i class="fa-solid fa-check"></i>
                    <span>Acknowledge</span>
                }
            </button>
        }
        else
        {
            <p class="waiting-message">Waiting for affected players...</p>
        }
    </div>
</div>

@code {
    /// <summary>
    /// The current pot amount to be matched.
    /// </summary>
    [Parameter]
    public int PotAmount { get; set; }

    /// <summary>
    /// Whether the results are currently loading.
    /// </summary>
    [Parameter]
    public bool IsLoading { get; set; }

    /// <summary>
    /// List of player names who must match the pot.
    /// </summary>
    [Parameter]
    public IReadOnlyList<string> LosingPlayers { get; set; } = [];

    /// <summary>
    /// Whether the current player is affected by pot matching.
    /// </summary>
    [Parameter]
    public bool IsPlayerAffected { get; set; }

    /// <summary>
    /// Whether the acknowledgement is being submitted.
    /// </summary>
    [Parameter]
    public bool IsSubmitting { get; set; }

    /// <summary>
    /// Callback when the player acknowledges the pot matching requirement.
    /// </summary>
    [Parameter]
    public EventCallback OnAcknowledge { get; set; }

    private async Task HandleClick()
    {
        if (IsSubmitting) return;
        await OnAcknowledge.InvokeAsync();
    }
}
